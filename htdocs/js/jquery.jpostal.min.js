function JpostalDatabase(a){this.address=[];this.map={};this.url={http:"//jpostal-1006.appspot.com/json/",https:"//jpostal-1006.appspot.com/json/"};this.find=function(c){var b=[];for(var d=0;d<this.address.length;++d){if(this.address[d][0]=="_"+c){b=this.address[d]}}return b};this.get=function(c){var e=["","","","","","","","",""];var b;var d;switch(c.length){case 3:case 4:case 5:case 6:d=c.substr(0,3);b=this.find(d);b=$.extend(e,b);break;case 7:b=this.find(c);if(!b){d=c.substr(0,3);b=this.find(d)}b=$.extend(e,b);break;default:b=e;break}return b};this.getUrl=function(c){var b="";switch(window.location.protocol){case"http:":b=this.url.http;break;case"https:":b=this.url.https;break}b=b+c+".json";return b};this.request=function(b,h){var g=this;var e=b.substr(0,3);if(b.length<=2||this.getStatus(e)!="none"||e.match(/[^0-9]/)){return false}this.setStatus(e,"waiting");var d=this.getUrl(e);var c={async:false,dataType:"jsonp",jsonpCallback:"jQuery_jpostal_callback",type:"GET",url:d,success:function(i,j){h()},error:function(j,i,k){},timeout:5000};$.ajax(c);return true};this.save=function(b){for(var e=0;e<b.length;++e){var d=b[e];var c=d[0];if(typeof this.map[c]=="undefined"){this.address.push(d);this.map[c]={state:"complete",time:0}}else{if(this.map[c].state=="waiting"){this.address.push(d);this.map[c].state="complete"}}}};this.getStatus=function(c){var e="";var d="_"+c;if(typeof this.map[d]=="undefined"){e="none"}else{if("complete"==this.map[d].state){e="complete"}else{var b=(new Date()).getTime()-this.map[d].time;if(b<5000){e="waiting"}else{e="none"}}}return e};this.setStatus=function(b){var c="_"+b;if(typeof this.map[c]=="undefined"){this.map[c]={state:"waiting",time:0}}this.map[c].time=(new Date()).getTime()}}function Jpostal(a){this.address="";this.jposDb=a;this.options={};this.postcode="";this.minLen=3;this.displayAddress=function(){if(this.postcode=="000info"){this.address[2]+=" "+this.getScriptSrc()}for(var b in this.options.address){var c=this.formatAddress(this.options.address[b],this.address);if(this.isSelectTagForPrefecture(b,this.options.address[b])){this.setSelectTagForPrefecture(b,c)}else{$(b).val(c)}}};this.isSelectTagForPrefecture=function(c,b){switch(b){case"%3":case"%p":case"%prefecture":if($(c).get(0).tagName.toUpperCase()=="SELECT"){f=true}else{f=false}break;default:f=false;break}return f};this.setSelectTagForPrefecture=function(g,b){$(g).val(b);if($(g).val()==b){return}value="";var d=$(g)[0];for(var c=0;c<d.options.length;++c){var e=d.options[c].text.indexOf(b);if(0<=e){value=d.options[c].value;break}}if(value!=""){$(g).val(value)}};this.formatAddress=function(d,b){var c=d;c=c.replace(/%3|%p|%prefecture/,b[1]);c=c.replace(/%4|%c|%city/,b[2]);c=c.replace(/%5|%t|%town/,b[3]);c=c.replace(/%6|%a|%address/,b[4]);c=c.replace(/%7|%n|%name/,b[5]);c=c.replace(/%8/,b[6]);c=c.replace(/%9/,b[7]);c=c.replace(/%10/,b[8]);return c};this.getScriptSrc=function(){var d="";var b=document.getElementsByTagName("script");for(var c=0;c<b.length;++c){if(0<=b[c].src.search(/jquery.jpostal.js/)){d=b[c].src}}return d};this.init=function(b){if(typeof b.postcode=="undefined"){throw new Error("postcode undefined")}if(typeof b.address=="undefined"){throw new Error("address undefined")}this.options.postcode=[];if(typeof b.postcode=="string"){this.options.postcode.push(b.postcode)}else{this.options.postcode=b.postcode}this.options.address=b.address;if(typeof b.url!="undefined"){this.jposDb.url=b.url}};this.main=function(){this.scanPostcode();if(this.postcode.length<this.minLen){return}var c=this;var b=this.jposDb.request(this.postcode,function(){c.callback()});if(!b){this.callback()}};this.callback=function(){this.address=this.jposDb.get(this.postcode);this.displayAddress()};this.scanPostcode=function(){var d="";switch(this.options.postcode.length){case 0:break;case 1:d=String($(this.options.postcode[0]).val());if(0<=d.search(/^([0-9]{3})([0-9A-Za-z]{4})/)){d=RegExp.$1+""+RegExp.$2}else{if(0<=d.search(/^([0-9]{3})-([0-9A-Za-z]{4})/)){d=RegExp.$1+""+RegExp.$2}else{if(0<=d.search(/^([0-9]{3})/)){d=RegExp.$1}else{d=""}}}break;case 2:var c=String($(this.options.postcode[0]).val());var b=String($(this.options.postcode[1]).val());if(0<=c.search(/^[0-9]{3}$/)){if(0<=b.search(/^[0-9A-Za-z]{4}$/)){d=c+b}else{d=c}}else{d=""}break}this.postcode=d}}var JposDb=new JpostalDatabase();function jQuery_jpostal_callback(a){JposDb.save(a)}(function(a){a.fn.jpostal=function(d){var e=new Jpostal(JposDb);e.init(d);if(typeof d.click=="string"&&d.click!=""){a(d.click).bind("click",function(g){e.main()})}else{for(var c=0;c<e.options.postcode.length;++c){var b=e.options.postcode[c];a(b).bind("keyup change",function(g){e.main()})}}}})(jQuery);